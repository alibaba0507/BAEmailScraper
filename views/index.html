<!DOCTYPE html>
<html>
<head>
    <title>Search Form</title>
	<style>
		.link-container {
			display: flex;
			align-items: center;
			justify-content: space-between;
			margin-bottom: 10px;
			padding: 5px;
			border: 1px solid #ccc;
		}

		.link-div {
			flex-grow: 1;
			margin-right: 10px;
		}

		button {
			padding: 5px 10px;
			background-color: #007bff;
			color: #fff;
			border: none;
			cursor: pointer;
		}

		button:hover {
			background-color: #0056b3;
		}
		#jsonOutput {
			max-height: 350px; /* Set the maximum height of the div */
			overflow-y: auto; /* Add vertical scroll when content overflows */
			border: 1px solid #ccc;
			padding: 10px;
		}
		.search-match-container {
			background-color: #ffffcc;
			border: 1px solid #cccccc;
			padding: 5px;
			margin: 5px 0;
		}
		.inner {
		  margin-left: 50px;
		  background-color: lightgray;
		  color: darkgray;
		}
	</style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Search Form</h1>
    <form action="/submit" method="post">
        <label for="searchQuery">Search:</label>
        <input type="text" id="searchQuery" name="searchQuery" required>
        <br>
        <input type="checkbox" id="extractRelated" name="extractRelated">
        <label for="extractRelated">Extract only related searches</label>
        <br>
        <div id="inDepthDiv" style="display: none;">
            <label for="inDepthValue">In-depth value:</label>
            <input type="number" id="inDepthValue" name="inDepthValue">
        </div>
        <br>
        <input type="submit" value="Submit">
    </form>
	<div>
    <!-- Add this to your index.html -->
    <div id="jsonOutput"></div>
	<input type="button" id="saveButton" value="Save JSON Output">
	</div>
    <script>
        $(document).ready(function() {
            $('#extractRelated').change(function() {
                if ($(this).prop('checked')) {
                    $('#inDepthDiv').show();
                } else {
                    $('#inDepthDiv').hide();
                }
            });
        });
    </script>
	<script src="/socket.io/socket.io.js"></script>
	<script>
	const socket = io();
    //------------------------ Save to File ----------------------
	document.addEventListener('DOMContentLoaded', function() {
		const saveButton = document.getElementById('saveButton');
		saveButton.addEventListener('click', function() {
			const jsonOutputDiv = document.getElementById('jsonOutput');
			const jsonOutputHTML = jsonOutputDiv.outerHTML;
			const head = document.head.outerHTML;
			const saved = `<!DOCTYPE html><html>${head}<body>${jsonOutputHTML}</body></html>`;
			// Emit the HTML content to the server
			socket.emit('saveHtml', saved);
		});
	});
	//-------------------------------------------------
	socket.on('jsonStructure', (jsonStructureObj) => {
		
		let searchQuery = jsonStructureObj['searchQuery'];
		let jsonStructure =  jsonStructureObj['jsonStructure'];

		const jsonOutputDiv = document.getElementById('jsonOutput');
		jsonOutputDiv.innerHTML = '';
		jsonOutputDiv.innerHTML = jsonStructure;//jsonStructureObj['jsonStructure'];
        
		const linkElements = jsonOutputDiv.querySelectorAll('.link-div');
        const eleemnts = [];
		// Wrap each link div in a container div
		linkElements.forEach((linkElement) => {
		   
			const containerDiv = document.createElement('div');
			containerDiv.classList.add('link-container');
            
			const linkText = linkElement.textContent;
             // Add your logic to style or manipulate the containerDiv here
			/*if (linkText.includes(searchQuery)) {
			    console.log(`---------${linkText}------`);
				containerDiv.classList.add('search-match-container');
			}*/
			const removeButton = document.createElement('button');
			removeButton.textContent = 'Remove';
			removeButton.addEventListener('click', () => {
				containerDiv.remove();
			});

			const insertButton = document.createElement('button');
			insertButton.textContent = 'Insert';
			insertButton.addEventListener('click', () => {
				document.getElementById('searchQuery').value = linkText;
			});

			containerDiv.appendChild(linkElement);
			containerDiv.appendChild(removeButton);
			containerDiv.appendChild(insertButton);

			jsonOutputDiv.appendChild(containerDiv);
		});
	});
	
	</script>
</body>
</html>